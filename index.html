<!doctype html>
<html>
    <head>
        <title>fab modules</title>
        <script src="./png_path.js"></script>
        <script src="./path_rml.js"></script>
        <script>
        window.onload = function() {

            var canvas = document.getElementById('pngview');
            document.ctx = canvas.getContext('2d');
        
            var pngInput = document.getElementById('loadpng');
            pngInput.addEventListener('change', function(e) {
                document.png_file = e.target.files[0];
                document.png_url = URL.createObjectURL(document.png_file);
                var img = new Image();
                img.src = document.png_url;
                img.onload = function(){
                    document.ctx.drawImage(img, 0, 0, 250, 250 * img.height/ img.width);
                }
                document.getElementById("makepath").disabled = false;
            }, false);
        
            var pathInput = document.getElementById('makepath');
            pathInput.addEventListener('click', function(e) {
                var reader = new FileReader;
                reader.readAsArrayBuffer(document.png_file);
                reader.onload = function() {
                    //png_path(INPUT_ARRAY,error(px) diameter(mm) offset(-1) overwrap(0-1) intensity(0-1))
                    var res = png_path(new Uint8Array(reader.result),1.1,0.25,1,0.5,0.5);
                    document.getElementById("makerml").disabled = false;
                };
            }, false);

            // var pathInput = document.getElementById('loadpath');
            // pathInput.addEventListener('change', function(e) {
            //   var file = e.target.files[0];
            //   var reader = new FileReader;
            //   reader.readAsArrayBuffer(file);
            //   reader.onload = function() {
            //     //path_rml(INPUT_ARRAY,direction(climb:1, conventional:0),speed(mm/s),jog(mm),xmin(mm),ymin(mm))
            //     var res = path_rml(new Uint8Array(reader.result),4,1,1,20,20);
            //   };
            // }, false);
        
            var rmlInput = document.getElementById('makerml');
            rmlInput.addEventListener('click', function(e) {
                var file_reader = new FileReader();
                file_reader.onload = function(e){
                    var path_uint8_arr = new Uint8Array(file_reader.result);
                    path_rml(path_uint8_arr,4,1,1,20,20);
                    document.getElementById("sendrml").disabled = false;
                };
                file_reader.readAsArrayBuffer(document.path_blob);
            }, false);
        };
        </script>
        <style>
            label {
                font-size: 14px;
            }
            .col {
                margin-left:30px;
                float:left;
                width: 300px;
            }
            #container1 {
                height:350px;
                clear:both;
            }
            #container2 {
                height:170px;
                clear:both;
            }
            #footer {
                margin: 30px;
            }

            .viewer {
                /* width:250px; */
                /* height:200px; */
                /* border:solid 1px black; */
            }
            #rmloutput{
                width:250px;
                height:250px;
            }
        </style>
    </head>
    <body>
        <h1>PNG - RML converter</h1>

        <div id="container1">
            <div class="col">
                <p>Load PNG</p>
                <p><input type="file" id="loadpng" accept="image/png"/></p>
                <canvas class="viewer" id="pngview"></canvas>
            </div>

            <div class="col">
                <p>Make PATH</p>
                <p>
                    <button id="makepath" disabled>make .path</button>
                    <span id="stat"></span>
                </p>
                <canvas class="viewer" id="pathview"></canvas>
            </div>

            <div class="col">
                <p>Make RML</p>
                <p><button id="makerml" disabled>make .rml</button></p>
                <textarea id="rmloutput"></textarea>
                <div id="disp"> </div>
            </div>
        </div>
        <div id="container2">
            <div class="col">
                <p>Send to Raspberry Pi</p>
                <p><label>ID</label>
                <input type="text" name="raspi_id" value="myraspi">
                </p>
                <p>
                <label>Address</label>
                <input type="text" name="raspi_addr" value="xxx.xxx.xxx.xxx">
                </p>
                <button id="send" disabled>send .rml</button>
            </div>
        </div>

        <div id="footer">
            (c) 2014 Shohei Aoki. Special thanks to Center for Bits and Atoms, MIT.
        </div>

    </body>
</html>
